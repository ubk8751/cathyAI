version: '3.8'
services:
  webbui_chat:
    container_name: cathyai_webbui_chat
    build: .
    working_dir: /app
    ports:
      - "8000:8000"
    volumes:
      - ../characters:/app/characters
      - ../public:/app/public
      - ./state:/state
    environment:
      PYTHONPATH: /app
    env_file:
      - .env
    restart: unless-stopped
    extra_hosts:
      - "host.docker.internal:host-gateway"

  webbui_auth_api:
    container_name: cathyai_webbui_auth_api
    build: .
    working_dir: /app
    command: ["python", "auth_api.py"]
    ports:
      - "8001:8001"
    volumes:
      - ./state:/state
    environment:
      PYTHONPATH: /app
    env_file:
      - .env
    restart: unless-stopped

  wakeup_helper:
    image: python:3.12-alpine
    container_name: cathyai_wakeup_helper
    working_dir: /app
    command: ["python", "wakeup.py"]
    volumes:
      - ./wakeup/wakeup.py:/app/wakeup.py:ro
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped

  wakeup_proxy:
    image: caddy:2
    container_name: cathyai_wakeup_proxy
    ports:
      - "7999:80"
    volumes:
      - ./wakeup/Caddyfile:/etc/caddy/Caddyfile:ro
    restart: unless-stopped